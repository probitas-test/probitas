name: Release

on:
  workflow_dispatch:
    inputs:
      version:
        description: "Version to release (e.g., v0.1.2)"
        required: true
        type: string

jobs:
  prepare:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    permissions:
      contents: write # For creating branches and PRs
      pull-requests: write

    steps:
      - uses: actions/checkout@v6
        with:
          ref: main
          token: ${{ secrets.PULL_REQUEST_TOKEN }}

      - uses: nixbuild/nix-quick-install-action@v34

      - name: Run release task
        run: |
          gh auth setup-git
          nix develop -c deno task release ${{ inputs.version }}
        env:
          GH_TOKEN: ${{ secrets.PULL_REQUEST_TOKEN }}
